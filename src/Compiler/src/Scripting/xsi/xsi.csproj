<?xml version="1.0" encoding="utf-8"?>
<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <UseXSharpKey>true</UseXSharpKey>
  </PropertyGroup>

  <Import Project="..\..\Compiler\CompilerCommon.props" />
  <!-- <Import Project="$(RepositoryEngineeringDir)targets\GenerateCompilerExecutableBindingRedirects.targets" /> -->
  <PropertyGroup>
    <OutputType>Exe</OutputType>
    <GenerateAssemblyInfo>false</GenerateAssemblyInfo>
    <Prefer32Bit>false</Prefer32Bit>
    <LargeAddressAware>true</LargeAddressAware>
    <RootNamespace>XSharpInteractive</RootNamespace>
    <TargetFrameworks>net472</TargetFrameworks>
    <UseAppHost>false</UseAppHost>
    <DefineConstants Condition="'$(TargetFramework)' == 'net472'">$(DefineConstants);NET46;NET472;</DefineConstants>
    <DefineConstants>$(DefineConstants);XSHARP;COMMITHASH</DefineConstants>
    <GenerateMicrosoftCodeAnalysisCommitHashAttribute>true</GenerateMicrosoftCodeAnalysisCommitHashAttribute>
    <!--Use the C# compiler created in this solution-->
    <CSCToolExe>$(GeneratedCompilerPath)csc.exe</CSCToolExe>
    <CreateZips>true</CreateZips>
    <NoWarn>8032;NU1603</NoWarn>
  </PropertyGroup>
  <ItemGroup Label="Project References">
    <ProjectReference Include="..\XSharpScripting\XSharpScripting.csproj" />
  </ItemGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' ">
    <DefineConstants>$(DefineConstants);TRACE;DEBUG</DefineConstants>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Public|AnyCPU'">
    <DefineConstants>$(DefineConstants);TRACE</DefineConstants>
  </PropertyGroup>
  <PropertyGroup Condition=" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' ">
    <DefineConstants>$(DefineConstants);NDEBUG</DefineConstants>
  </PropertyGroup>
  <ItemGroup>
    <PackageReference Include="System.ValueTuple" Version="$(SystemValueTupleVersion)" />
    <PackageReference Include="Microsoft.CSharp" Version="$(MicrosoftCSharpVersion)" />
  </ItemGroup>
  <ItemGroup>
    <None Include="App.config" />
    <None Include="xsi.coreclr.rsp" Condition="'$(TargetFramework)' == 'netcoreapp3.1'">
      <Link>xsi.rsp</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
    <None Include="xsi.desktop.rsp" Condition="'$(TargetFramework)' != 'netcoreapp3.1'">
      <Link>xsi.rsp</Link>
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
  </ItemGroup>
  <ItemGroup>
    <Compile Include="$(CommonDir)CommonAssemblyInfo.cs">
      <Link>Properties\CommonAssemblyInfo.cs</Link>
    </Compile>
  </ItemGroup>
  <Import Project="$(RepositoryEngineeringDir)targets\DiaSymReaderNative.targets" />
  <Target Name="DeleteCSFiles" AfterTargets="Build" Condition="'$(TargetFramework)' != '' ">
    <ItemGroup>
      <FilesToDelete Include="$(OutputPath)\CS*.*" /> 
    </ItemGroup>
    <Delete Files="@(FilesToDelete)" />
  </Target>
  <!-- Copy the files from the XSC folder into the XSI folder-->
  <Target Name="CopyCompilerFiles" AfterTargets="Build" >
    <ItemGroup>
      <FilesToCopy Include="$(OutputPath.Replace('xsi','xsc'))X*.*" />
    </ItemGroup>
    <Copy SourceFiles="@(FilesToCopy)" DestinationFolder="$(OutputPath)" />
  </Target>
  <!-- Zip the XSI output folder -->
  <Target Name="ZipOutputPath" AfterTargets="CopyCompilerFiles" Condition="'$(TargetFramework)' != '' AND  '$(CreateZips)' != '' ">
    <MakeDir Directories="$(ZipsDir)" />
    <ZipDirectory SourceDirectory="$(OutputPath)" DestinationFile="$(ZipsDir)\Bin.$(TargetFramework).$(Configuration).zip" Overwrite="true" />
  </Target>
</Project>