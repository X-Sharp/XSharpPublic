<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../helpproject.xsl" ?>
<topic template="Default" modified="2024-07-26T01:50:06.343+08:00" lasteditedby="niuji" version="2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../helpproject.xsd">
  <title>Workarea 事件</title>
  <body>
    <header>
      <para styleclass="Heading1">Workarea 事件</para>
    </header>
    <para styleclass="Normal"></para>
    <para styleclass="Normal">在 Build 2.08 中，我们添加了用于注册接收工作区事件的事件处理程序的选项。这可用于监视对工作区的访问，例如将此信息写入日志文件。</para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal">有 2 种方法可以安装此事件处理程序：</para>
    <para styleclass="Normal"></para>
    <list id="0" type="ol" listtype="decimal" formatstring="&#37;&#48;&#58;&#115;&#46;" format-charset="DEFAULT_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Body Text" style="font-family:Arial; font-size:11pt; color:#000000;">
      <li styleclass="Body Text"><text styleclass="Normal">创建实现</text>&#32;<link displaytype="text" defaultstyle="true" type="topiclink" href="html\T_XSharp_DbNotifyEventHandler.htm" domain="XSharpRef.chm">DbNotifyEventHandler</link> 委托的函数/方法。<br/><br/><text styleclass="" style="font-family:Consolas; font-size:9pt; color:#0000ff;">PUBLIC</text><text styleclass="" style="font-family:Consolas; font-size:9pt; color:#000000;">&#32;</text><text styleclass="" style="font-family:Consolas; font-size:9pt; color:#0000ff;">DELEGATE</text><text styleclass="" style="font-family:Consolas; font-size:9pt; color:#000000;"> XSharp.DbNotifyEventHandler(osender </text><text styleclass="" style="font-family:Consolas; font-size:9pt; color:#0000ff;">AS</text><text styleclass="" style="font-family:Consolas; font-size:9pt; color:#000000;"> XSharp.RDD.IRDD, e </text><text styleclass="" style="font-family:Consolas; font-size:9pt; color:#0000ff;">AS</text><text styleclass="" style="font-family:Consolas; font-size:9pt; color:#000000;"> XSharp.DBNotifyEventArgs) </text><text styleclass="" style="font-family:Consolas; font-size:9pt; color:#0000ff;">AS</text><text styleclass="" style="font-family:Consolas; font-size:9pt; color:#000000;">&#32;</text><text styleclass="" style="font-family:Consolas; font-size:9pt; color:#0000ff;">VOID</text><br/></li>
      <li styleclass="Body Text">您创建一个实现 <link displaytype="text" defaultstyle="true" type="topiclink" href="html\T_XSharp_IDbNotify.htm" domain="XSharpRef.chm">IDbnotify</link> 接口的类，该接口只有一个名为 Notify() 的方法，其原型与 1） 中的委托相同。</li>
    </list>
    <para styleclass="Heading1">重要</para>
    <list id="1" type="ul" listtype="bullet" formatstring="&#183;" format-charset="SYMBOL_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Normal" style="font-family:Symbol; font-size:11pt; color:#000000;">
      <li styleclass="Normal">如果你不想拖慢整个 RDD 系统的运行速度，那么你的事件处理程序就应该尽量少做一些事情。</li>
      <li styleclass="Normal">不要在事件处理程序中操作任何工作区，以避免递归。</li>
      <li styleclass="Normal">尽快取消注册事件处理程序。</li>
      <li styleclass="Normal">如果您使用对象进行事件处理，您就有责任管理该对象的生命周期。请务必在对象超出范围之前取消注册。</li>
      <li styleclass="Normal">在某些情况下(对多个工作区进行操作，如 DbCommitAll() 和 DbUnLockAll())，事件处理程序并不总能收到发送者参数。请做好准备！</li>
      <li styleclass="Normal">事件是从 CoreDb 层发送的。因此，如果 RDD 中的一个方法调用了该 RDD 中的另一个方法（例如，创建 order 后，CreateOrder() 可能会调用 GoTop()），那么您将看不到第二个事件，只能看到与从 CoreDb() 层调用的方法相关的事件，因此在本例中与创建 order 相关的事件。</li>
    </list>
    <para styleclass="Heading1">示例</para>
    <para styleclass="Body Text"></para>
    <para styleclass="Body Text">如果使用方法 1，则需要在 CoreDb.Notify 中添加事件处理程序，如下例所示：</para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#ff0000;">FUNCTION</text><text style="font-weight:normal; font-style:normal; color:#000000;"> NotifyRDDOperations(oRDD </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> XSharp.RDD.IRdd, oEvent </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> XSharp.DbNotifyEventArgs) </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">VOID</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">IF</text><text style="font-weight:normal; font-style:normal; color:#000000;"> oRDD != </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">NULL</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; &#160; &#160;? oRDD:Alias, oEvent:Type:ToString(), oEvent:Data</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">ELSE</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; &#160; &#160;? &quot;(no area)&quot;,oEvent:Type:ToString(), oEvent:Data</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">ENDIF</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">RETURN</text><br/><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">FUNCTION</text><text style="font-weight:normal; font-style:normal; color:#000000;"> Start() </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">VOID</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; CoreDb.Notify += NotifyRDDOperations</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160;? DbCreate(&quot;Test&quot;, {{&quot;FLD1&quot; , &quot;C&quot; , 10 , 0} }) &#160; &#160;</text><text style="font-weight:bold; font-style:italic; color:#339966;">// 这将触发一个通知</text><br/><tab /><text style="font-weight:normal; font-style:normal; color:#000000;">CoreDb.Notify -= NotifyRDDOperations</text><tab /><tab /><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 请不要忘记取消注册！</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">WAIT</text><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">RETURN</text></para>
    <para styleclass="Body Text">该函数的参数为：</para>
    <para styleclass="Body Text"></para>
    <para styleclass="List1">oRDD<tab /> &#160;触发事件的 RDD。对于涉及多个工作区的事件，如 DbUnlockAll() ，该值可能为 NULL。</para>
    <para styleclass="List1">oEvent<tab /> &#160;一个事件处理程序对象，它有 2 个属性</para>
    <para styleclass="List1"><tab />Type<tab /><link displaytype="text" defaultstyle="true" type="topiclink" href="html\T_XSharp_RDD_Enums_DbNotificationType.htm" domain="XSharpRef.chm">DbNotificationType</link> 枚举值</para>
    <para styleclass="List1"><tab />Data<tab />包含事件附加信息的对象，如 PieldPut 的字段名和 Append 或 Delete 事件的记录编号。</para>
    <para styleclass="List"></para>
    <para styleclass="Body Text">第二种方法是创建一个类，使用 <link displaytype="text" defaultstyle="true" type="topiclink" href="html\M_XSharp_Core_Functions_DbRegisterClient.htm" domain="XSharpRef.chm">DbRegisterClient</link>() 函数注册该类，然后使用 <link displaytype="text" defaultstyle="true" type="topiclink" href="html\M_XSharp_Core_Functions_DbUnRegisterClient.htm" domain="XSharpRef.chm">DbUnRegisterClient</link> 函数取消注册该类。</para>
    <para styleclass="Body Text">类中的方法将获得与事件处理函数相同的参数：</para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#ff0000;">CLASS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> Notifier </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">IMPLEMENTS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> IDbnotify</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">METHOD</text><text style="font-weight:normal; font-style:normal; color:#000000;"> Notify(oRDD </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> XSharp.RDD.IRdd, oEvent </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> XSharp.DbNotifyEventArgs) </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">VOID</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">IF</text><text style="font-weight:normal; font-style:normal; color:#000000;"> oRDD != </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">NULL</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; &#160; &#160; &#160;? oRDD:Alias, oEvent:Type:ToString(), oEvent:Data</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">ELSE</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; &#160; &#160; &#160;? &quot;(no area)&quot;,oEvent:Type:ToString(), oEvent:Data</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">ENDIF</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">RETURN</text><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">END</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">CLASS</text><br/><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">FUNCTION</text><text style="font-weight:normal; font-style:normal; color:#000000;"> Start() </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">VOID</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">LOCAL</text><text style="font-weight:normal; font-style:normal; color:#000000;"> oNot </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> Notifier</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; oNot := Notifier{}</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; DbRegisterClient(oNot) &#160; </text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; ? DbCreate(&quot;Test&quot;, {{&quot;FLD1&quot; , &quot;C&quot; , 10 , 0} }) &#160; &#160;</text><text style="font-weight:bold; font-style:italic; color:#339966;">// 这将触发一个通知</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; DbUnRegisterClient(oNot) &#160;</text><tab /><tab /><tab /><tab /><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160;</text><text style="font-weight:bold; font-style:italic; color:#339966;">// 请不要忘记取消注册！</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><tab /><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">WAIT</text><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">RETURN</text></para>
    <para styleclass="Heading1">参看</para>
    <para styleclass="Body Text"><link displaytype="text" defaultstyle="true" type="topiclink" href="html\T_XSharp_RDD_Enums_DbNotificationType.htm" domain="XSharpRef.chm">DbNotificationType</link>&#32;</para>
    <para styleclass="Body Text"><link displaytype="text" defaultstyle="true" type="topiclink" href="html\M_XSharp_Core_Functions_DbRegisterClient.htm" domain="XSharpRef.chm">DbRegisterClient</link>()</para>
    <para styleclass="Body Text"><link displaytype="text" defaultstyle="true" type="topiclink" href="html\M_XSharp_Core_Functions_DbUnRegisterClient.htm" domain="XSharpRef.chm">DbUnRegisterClient</link></para>
    <para styleclass="Body Text"><link displaytype="text" defaultstyle="true" type="topiclink" href="html\T_XSharp_DbNotifyEventHandler.htm" domain="XSharpRef.chm">DbNotifyEventHandler</link></para>
    <para styleclass="Body Text"><link displaytype="text" defaultstyle="true" type="topiclink" href="html\T_XSharp_IDbNotify.htm" domain="XSharpRef.chm">IDbnotify</link>&#32;</para>
    <para styleclass="Body Text"></para>
  </body>
</topic>
