<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../helpproject.xsl" ?>
<topic template="Default" lasteditedby="robert" version="2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../helpproject.xsd">
  <title>XS9068</title>
  <keywords>
    <keyword>PSZ</keyword>
    <keyword>String2Psz()</keyword>
    <keyword>StringAlloc()</keyword>
    <keyword>XS9068</keyword>
  </keywords>
  <body>
    <header>
      <para styleclass="Heading1">Warning XS9068</para>
    </header>
    <para styleclass="Normal">The compiler generated an automatic conversion to PSZ. This will create a memory leak in your application. Please use String2Psz() to let the compiler manage the lifetime of the PSZ or use StringAlloc() and memory the lifetime of the PSZ yourself.</para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal">This may happen in code like this:</para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;">FUNCTION</text><text style="font-weight:normal; font-style:normal; text-decoration:none; color:#000000;"> Start() </text><text style="font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; text-decoration:none; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;">VOID</text><br/><text style="font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;">LOCAL</text><text style="font-weight:normal; font-style:normal; text-decoration:none; color:#000000;"> uValue </text><text style="font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; text-decoration:none; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;">USUAL</text><br/><text style="font-weight:normal; font-style:normal; text-decoration:none; color:#000000;">uValue := &quot;SomeString&quot;</text><br/><text style="font-weight:normal; font-style:normal; text-decoration:none; color:#000000;">? Test(uValue)</text><br/><text style="font-weight:normal; font-style:normal; text-decoration:none; color:#000000;">? Test(</text><text style="font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;">PSZ</text><text style="font-weight:normal; font-style:normal; text-decoration:none; color:#000000;">(</text><text style="font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;">_CAST</text><text style="font-weight:normal; font-style:normal; text-decoration:none; color:#000000;">, &quot;AnotherString&quot;))</text><br/><text style="font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;">RETURN</text><br/><br/><text style="font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;">FUNCTION</text><text style="font-weight:normal; font-style:normal; text-decoration:none; color:#000000;"> Test(p </text><text style="font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; text-decoration:none; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;">PSZ</text><text style="font-weight:normal; font-style:normal; text-decoration:none; color:#000000;">) </text><text style="font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; text-decoration:none; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;">STRING</text><br/><text style="font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;">RETURN</text><text style="font-weight:normal; font-style:normal; text-decoration:none; color:#000000;"> Psz2String(p)</text></para>
    <para styleclass="Body Text"><text style="font-weight:normal; font-style:normal; color:#000000;">The compiler detects that the Test() function wants to receive a Psz() and creates a conversion from USUAL to PSZ on the fly. When the contents of the usual is a Pointer then no memory will be allocated. When the contents of the usual is a string then memory will be allocated that will hold the PSZ after the conversion from Unicode to Ansi.</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;">The compiler does not know what the Test() function will do with the PSZ and can&apos;t therefor control the lifetime of the variable. We recommend that you change the code to either use String2Psz() or StringAlloc().</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;">Of course these functions will only work if the usual contains a string like in the example above.</text><br/></para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#ff0000;">FUNCTION</text><text style="font-weight:normal; font-style:normal; color:#000000;"> Start() </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">VOID</text><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">LOCAL</text><text style="font-weight:normal; font-style:normal; color:#000000;"> uValue </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">USUAL</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;">uValue := &quot;SomeString&quot;</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;">? Test(String2Psz(uValue))</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;">? Test(String2Psz(</text><text style="font-weight:normal; font-style:normal; text-decoration:none; color:#000000;">&quot;AnotherString&quot;</text><text style="font-weight:normal; font-style:normal; color:#000000;">))</text><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">RETURN</text><br/><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">FUNCTION</text><text style="font-weight:normal; font-style:normal; color:#000000;"> Test(p </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">PSZ</text><text style="font-weight:normal; font-style:normal; color:#000000;">) </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">STRING</text><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">RETURN</text><text style="font-weight:normal; font-style:normal; color:#000000;"> Psz2String(p)</text><br/></para>
    <para styleclass="Body Text"><text style="font-weight:normal; font-style:normal; color:#000000;">or</text></para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#ff0000;">FUNCTION</text><text style="font-weight:normal; font-style:normal; color:#000000;"> Start() </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">VOID</text><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">LOCAL</text><text style="font-weight:normal; font-style:normal; color:#000000;"> uValue </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">USUAL</text><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">LOCAL</text><text style="font-weight:normal; font-style:normal; color:#000000;"> p </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">as</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">PSZ</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;">uValue := &quot;SomeString&quot;</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;">p := StringAlloc(uValue)</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;">? Test(p)</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;">MemFree(p)</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;">p := StringAlloc(</text><text style="font-weight:normal; font-style:normal; text-decoration:none; color:#000000;">&quot;AnotherString&quot;</text><text style="font-weight:normal; font-style:normal; color:#000000;">)</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;">? Test(p)</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;">MemFree(p)</text><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">RETURN</text><br/><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">FUNCTION</text><text style="font-weight:normal; font-style:normal; color:#000000;"> Test(p </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">PSZ</text><text style="font-weight:normal; font-style:normal; color:#000000;">) </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">STRING</text><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">RETURN</text><text style="font-weight:normal; font-style:normal; color:#000000;"> Psz2String(p)</text><br/></para>
  </body>
</topic>
