<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../helpproject.xsl" ?>
<topic template="Default" modified="2024-06-30T00:39:41.093+08:00" lasteditedby="niuji" version="2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../helpproject.xsd">
  <title>LOCAL 语句</title>
  <keywords>
    <keyword>Arrays<keyword>creating</keyword><keyword>declaring</keyword></keyword>
    <keyword>Creating<keyword>arrays</keyword><keyword>variables</keyword></keyword>
    <keyword>Declaration statements</keyword>
    <keyword>LOCAL statement</keyword>
    <keyword>Statements</keyword>
    <keyword>STATIC LOCAL statement</keyword>
    <keyword>Variable declaration</keyword>
    <keyword>Variables<keyword>creating</keyword><keyword>declaring</keyword></keyword>
  </keywords>
  <body>
    <header>
      <para styleclass="Heading1">LOCAL 语句</para>
    </header>
    <para styleclass="Heading1">用途</para>
    <para styleclass="Body Text">声明并初始化局部变量和数组。</para>
    <para styleclass="Heading1">语法</para>
    <para styleclass="Code with box">[STATIC] LOCAL &lt;idVar&gt; [:= &lt;uValue&gt;] [,...] [AS | IS &lt;idType&gt;] [, ...]<br/>[STATIC] LOCAL DIM &lt;ArraySpec&gt; [, ...] AS | IS &lt;idType&gt; [, ...]<br/>[STATIC] LOCAL &lt;ArraySpec&gt; [, ...] [AS ARRAY] [, ...]<br/>LOCAL ARRAY &lt;arrayName&gt; <text style="font-weight:bold;">(</text> &lt;nRows&gt; [, &lt;nColumns&gt;] <text style="font-weight:bold;">)</text> [, &lt;arrayName&gt; ( &lt;nRows&gt; [, &lt;nColumns&gt;] ) ] &#160; &#160; // 仅用于 FoxPro 方言<br/>LOCAL ARRAY &lt;arrayName&gt; <text style="font-weight:bold;">[</text> &lt;nRows&gt; [, &lt;nColumns&gt;] <text style="font-weight:bold;">]</text> [, &lt;arrayName&gt; <text style="font-weight:bold;">[</text> &lt;nRows&gt; [, &lt;nColumns&gt;] <text style="font-weight:bold;">]</text> ] &#160; &#160; // 仅用于 FoxPro 方言</para>
    <para styleclass="" style="text-align:left; text-indent:0px; margin-top:0px; margin-right:16px; margin-bottom:0px; margin-left:12px; line-height:1.00; background-color:transparent; white-space:normal; page-break-inside:auto; page-break-after:auto; border:none; tabstops:64px left,320px left ;"></para>
    <para styleclass="Body Text"><text style="font-family:Arial; font-size:10pt; font-weight:normal; font-style:normal; text-transform:none; vertical-align:baseline; color:#000000; background-color:transparent; letter-spacing:normal; letter-scaling:100%;">注：为方便起见，LOCAL 语句使用了多个语法。 如果每个定义之间用逗号隔开，则可以使用一条 LOCAL 语句声明变量、动态数组和维数组。</text></para>
    <para styleclass="" style="text-align:left; text-indent:0px; margin-top:0px; margin-right:16px; margin-bottom:0px; margin-left:12px; line-height:1.00; background-color:transparent; white-space:normal; page-break-inside:auto; page-break-after:auto; border:none; tabstops:64px left,320px left ;"></para>
    <para styleclass="Heading1">参数</para>
    <para styleclass="List">STATIC<tab />使局部变量在调用声明实体时保留其值，但不影响其可见性。</para>
    <para styleclass="List"><snippet src="__localSpec" inline="false"/></para>
    <para styleclass="Heading1">描述</para>
    <para styleclass="Body Text">LOCAL 是一种声明语句，用于将一个或多个变量或数组声明为当前例程（即函数、方法或存储过程）的局部变量或数组。 与其他变量声明语句(如 FIELD 和 MEMVAR)一样，必须将 LOCAL 语句放在定义例程中的任何可执行语句(包括 PRIVATE、PUBLIC 和 PARAMETERS)之前。</para>
    <para styleclass="Body Text"></para>
    <para styleclass="Body Text">局部变量声明会隐藏所有继承的私有变量、可见的公有变量、实例变量、全局变量和同名常量。 变量名的搜索顺序如下：</para>
    <para styleclass="Indented" style="text-align:left; text-indent:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; line-height:1.00; background-color:transparent; white-space:normal; page-break-inside:auto; page-break-after:auto; border:none; tabstops:none;"><text styleclass="Normal">1.</text><tab /><text styleclass="Normal">LOCAL、局部参数、MEMVAR 和 FIELD</text></para>
    <para styleclass="Indented" style="text-align:left; text-indent:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; line-height:1.00; background-color:transparent; white-space:normal; page-break-inside:auto; page-break-after:auto; border:none; tabstops:none;"><text styleclass="Normal">2.</text><tab /><text styleclass="Normal">SELF 实例变量（即在类方法中不带 &lt;idObject&gt;: 前缀）</text></para>
    <para styleclass="Indented" style="text-align:left; text-indent:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; line-height:1.00; background-color:transparent; white-space:normal; page-break-inside:auto; page-break-after:auto; border:none; tabstops:none;"><text styleclass="Normal">3.</text><tab /><text styleclass="Normal">GLOBALs 和 DEFINEs</text></para>
    <para styleclass="" style="text-align:left; text-indent:0px; margin-top:0px; margin-right:16px; margin-bottom:0px; margin-left:12px; line-height:1.00; background-color:transparent; white-space:normal; page-break-inside:auto; page-break-after:auto; border:none; tabstops:64px left,320px left ;"></para>
    <para styleclass="Body Text">如果 LOCAL 语句声明的变量名已在同一例程中声明（使用 FIELD、LOCAL 或 MEMVAR），则编译器会出错。</para>
    <para styleclass="Body Text"></para>
    <para styleclass="Body Text">局部变量只在当前例程中可见，与私有变量不同，在被调用的例程中不可见。 如果例程被递归调用，每次递归激活都会创建一组新的局部变量。</para>
    <para styleclass="Body Text"></para>
    <para styleclass="Body Text">除非指定 STATIC 关键字，否则每次开始执行声明局部变量的例程时，都会自动创建局部变量。 它们将继续存在并保留其值，直到声明例程将控制权返回给调用它的例程。</para>
    <para styleclass="Body Text"></para>
    <para styleclass="Body Text">STATIC 关键字可作为局部变量的生命周期修改器，防止变量在创建实体返回调用例程时从内存中释放。</para>
    <para styleclass="Body Text"></para>
    <para styleclass="Body Text">这一点很重要！ 当调用包含静态变量声明的应用程序时，变量将在程序开始执行前创建并初始化。 因此，初始值只在每次程序运行时分配一次，而不是在每次调用创建实体时分配。</para>
    <para styleclass="" style="text-align:left; text-indent:0px; margin-top:0px; margin-right:16px; margin-bottom:0px; margin-left:12px; line-height:1.00; background-color:transparent; white-space:normal; page-break-inside:auto; page-break-after:auto; border:none; tabstops:64px left,320px left ;"></para>
    <para styleclass="Heading1">备注</para>
    <para styleclass="Body Text"><text style="font-family:Arial; font-size:10pt; font-weight:normal; font-style:normal; text-transform:none; vertical-align:baseline; color:#000000; background-color:transparent; letter-spacing:normal; letter-scaling:100%;">局部参数： &#160;通过 FUNCTION、METHOD 和 PROCEDURE 语句，可以在实体名称后面的括号中声明局部参数列表。 例如</text></para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#ff0000;">FUNCTION</text><text style="font-weight:normal; font-style:normal; color:#000000;"> &lt;idFunction&gt;(&lt;idParamList&gt;)</text></para>
    <para styleclass="Body Text"><text style="font-family:Arial; font-size:10pt; font-weight:normal; font-style:normal; text-transform:none; vertical-align:baseline; color:#000000; background-color:transparent; letter-spacing:normal; letter-scaling:100%;">通过代码块导出局部变量： &#160;创建代码块时，可以在代码块定义中访问创建实体中定义的局部变量，而无需将其作为参数传递（因为局部变量对代码块是可见的）。 再加上可以将代码块作为参数传递，因此可以导出局部变量。 例如</text></para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#ff0000;">FUNCTION</text><text style="font-weight:normal; font-style:normal; color:#000000;"> One() </text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">LOCAL</text><text style="font-weight:normal; font-style:normal; color:#000000;"> nVar := 10 </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">INT</text><text style="font-weight:normal; font-style:normal; color:#000000;">, cbAdd </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> CODEBLOCK</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; cbAdd := {|nValue| nValue + nVar}</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; ? NextFunc(cbAdd) &#160; &#160; &#160;</text><text style="font-weight:bold; font-style:italic; color:#339966;">// 结果: &#160;210</text><br/><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">FUNCTION</text><text style="font-weight:normal; font-style:normal; color:#000000;"> NextFunc(cbAddEmUp)</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">RETURN</text><text style="font-weight:normal; font-style:normal; color:#000000;"> EVAL(cbAddEmUp, 200)</text></para>
    <para styleclass="" style="text-align:left; text-indent:0px; margin-top:0px; margin-right:16px; margin-bottom:0px; margin-left:12px; line-height:1.00; background-color:transparent; white-space:normal; page-break-inside:auto; page-break-after:auto; border:none; tabstops:64px left,320px left ;"></para>
    <para styleclass="Body Text">当在 NextFunc() 中对代码块进行求值时，函数 One() 的局部参数 nVar 将变得可见，即使它没有直接作为参数传递。</para>
    <para styleclass="Body Text"></para>
    <para styleclass="Body Text">宏表达式： &#160;不能在宏变量和表达式中引用局部变量。 如果在宏变量中引用局部变量，将引用同名的私有变量或公有变量。 如果不存在此类变量，则会出现运行时错误。</para>
    <para styleclass="Body Text">局部变量的类型： &#160;由于 Type() 使用宏运算符 (&amp;) 来评估其参数，因此不能用它来确定局部变量或包含局部变量引用的表达式的类型。 不过，您可以使用 ValType() 评估参数并返回返回值的类型。</para>
    <para styleclass="Body Text">内存文件： &#160;不能保存或恢复局部变量。</para>
    <para styleclass="Heading1">示例</para>
    <para styleclass="Body Text">下面的示例声明了两个局部数组和两个局部变量：</para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#ff0000;">LOCAL</text><text style="font-weight:bold; font-style:normal; color:#000000;"> aArray1</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">[20,</text><text style="font-weight:bold; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">10],</text><text style="font-weight:bold; font-style:normal; color:#000000;"> aArray2</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">[20][10],</text><text style="font-weight:bold; font-style:normal; color:#000000;"> var1</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">,</text><text style="font-weight:bold; font-style:normal; color:#000000;"> var2</text></para>
    <para styleclass="Body Text">本例声明了两个带有初始化器的局部变量。 第一个变量初始化为一个日期值，第二个变量初始化为一个数组：</para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#ff0000;">LOCAL</text><text style="font-weight:bold; font-style:normal; color:#000000;"> dWhen </text><text style="font-weight:bold; font-style:normal; color:#0000ff;">:=</text><text style="font-weight:bold; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">TODAY</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">()</text><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">LOCAL</text><text style="font-weight:bold; font-style:normal; color:#000000;"> aVegies </text><text style="font-weight:bold; font-style:normal; color:#0000ff;">:=</text><text style="font-weight:bold; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">{</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">&quot;Tomato&quot;,</text><text style="font-weight:bold; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">&quot;Chickadee&quot;,</text><text style="font-weight:bold; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">&quot;Butterbean&quot;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">}</text></para>
    <para styleclass="Body Text">在本例中，变量 x 和维数数组 z 的类型为 INT，而变量 cName 和 cAddr 的类型为 STRING：</para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#ff0000;">LOCAL</text><text style="font-weight:bold; font-style:normal; color:#000000;"> x</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">,</text><text style="font-weight:bold; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">DIM</text><text style="font-weight:bold; font-style:normal; color:#000000;"> z</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">[100]</text><text style="font-weight:bold; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:bold; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">INT</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">,</text><text style="font-weight:bold; font-style:normal; color:#000000;"> cName</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">,</text><text style="font-weight:bold; font-style:normal; color:#000000;"> cAddr </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:bold; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">STRING</text></para>
    <para styleclass="Body Text">下一个示例声明了带初始化器和不带初始化器的静态变量：</para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#ff0000;">STATIC</text><text style="font-weight:bold; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">LOCAL</text><text style="font-weight:bold; font-style:normal; color:#000000;"> aArray1</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">[20,</text><text style="font-weight:bold; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">10],</text><text style="font-weight:bold; font-style:normal; color:#000000;"> aArray2</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">[20][10]</text><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">STATIC</text><text style="font-weight:bold; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">LOCAL</text><text style="font-weight:bold; font-style:normal; color:#000000;"> cVar</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">,</text><text style="font-weight:bold; font-style:normal; color:#000000;"> cVar2</text><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">STATIC</text><text style="font-weight:bold; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">LOCAL</text><text style="font-weight:bold; font-style:normal; color:#000000;"> cString </text><text style="font-weight:bold; font-style:normal; color:#0000ff;">:=</text><text style="font-weight:bold; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">&quot;my string&quot;,</text><text style="font-weight:bold; font-style:normal; color:#000000;"> var</text><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">STATIC</text><text style="font-weight:bold; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">LOCAL</text><text style="font-weight:bold; font-style:normal; color:#000000;"> aArray </text><text style="font-weight:bold; font-style:normal; color:#0000ff;">:=</text><text style="font-weight:bold; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">{</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">1,</text><text style="font-weight:bold; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">2,</text><text style="font-weight:bold; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">3</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">}</text></para>
    <para styleclass="Body Text">这里，静态变量在函数中被操作。 在本例中，每次调用函数时，计数变量都会自增：</para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#ff0000;">FUNCTION</text><text style="font-weight:bold; font-style:normal; color:#000000;"> MyCounter</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">(</text><text style="font-weight:bold; font-style:normal; color:#000000;">nNewValue</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">)</text><br/><tab /><tab /><tab /><text style="font-weight:bold; font-style:normal; color:#ff00ff;">// 分配一次初始值</text><br/><tab /><text style="font-weight:bold; font-style:normal; color:#ff0000;">STATIC</text><text style="font-weight:bold; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">LOCAL</text><text style="font-weight:bold; font-style:normal; color:#000000;"> nCounter </text><text style="font-weight:bold; font-style:normal; color:#0000ff;">:=</text><text style="font-weight:bold; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#0000ff;">0</text><br/><tab /><text style="font-weight:bold; font-style:normal; color:#ff0000;">IF</text><text style="font-weight:bold; font-style:normal; color:#000000;"> nNewValue </text><text style="font-weight:bold; font-style:normal; color:#0000ff;">!=</text><text style="font-weight:bold; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">NIL</text><br/><tab /><tab /><tab /><text style="font-weight:bold; font-style:normal; color:#ff00ff;">// nCounter 的新值</text><br/><tab /><text style="font-weight:bold; font-style:normal; color:#000000;">nCounter </text><text style="font-weight:bold; font-style:normal; color:#0000ff;">:=</text><text style="font-weight:bold; font-style:normal; color:#000000;"> nNewValue</text><br/><tab /><text style="font-weight:bold; font-style:normal; color:#ff0000;">ELSE</text><br/><tab /><tab /><tab /><text style="font-weight:bold; font-style:normal; color:#ff00ff;">// 递增 nCounter</text><br/><tab /><tab /><text style="font-weight:bold; font-style:normal; color:#0000ff;">++</text><text style="font-weight:bold; font-style:normal; color:#000000;">nCounter</text><br/><tab /><text style="font-weight:bold; font-style:normal; color:#ff0000;">ENDIF</text><br/><tab /><text style="font-weight:bold; font-style:normal; color:#ff0000;">RETURN</text><text style="font-weight:bold; font-style:normal; color:#000000;"> nCounter</text></para>
    <para styleclass="" style="text-align:left; text-indent:0px; margin-top:0px; margin-right:16px; margin-bottom:0px; margin-left:12px; line-height:1.00; background-color:transparent; white-space:normal; page-break-inside:auto; page-break-after:auto; border:none; tabstops:64px left,320px left ;"></para>
    <para styleclass="Heading1">参见</para>
    <para styleclass="link"><link displaytype="text" defaultstyle="true" type="topiclink" href="command_FIELD" style="font-weight:normal;">FIELD</link><text style="font-weight:normal;">, </text><link displaytype="text" defaultstyle="true" type="topiclink" href="command_FUNCTION" style="font-weight:normal;">FUNCTION</link><text style="font-weight:normal;">, </text><link displaytype="text" defaultstyle="true" type="topiclink" href="command_DEFINE" style="font-weight:normal;">DEFINE</link><text style="font-weight:normal;">, </text><link displaytype="text" defaultstyle="true" type="topiclink" href="command_GLOBAL" style="font-weight:normal;">GLOBAL</link><text style="font-weight:normal;">, </text><link displaytype="text" defaultstyle="true" type="topiclink" href="command_MEMVAR" style="font-weight:normal;">MEMVAR</link><text style="font-weight:normal;">, </text><link displaytype="text" defaultstyle="true" type="topiclink" href="command_METHOD" style="font-weight:normal;">METHOD</link><text style="font-weight:normal;">, </text><link displaytype="text" defaultstyle="true" type="topiclink" href="command_PROCEDURE" style="font-weight:normal;">PROCEDURE</link><text style="font-weight:normal;">, </text><link displaytype="text" defaultstyle="true" type="topiclink" href="command_STATIC" style="font-weight:normal;">STATIC</link><text styleclass="Normal">, </text><link displaytype="text" defaultstyle="true" type="topiclink" href="command_DECLARE" styleclass="Normal">DIMENSION</link><text styleclass="Normal">, </text><link displaytype="text" defaultstyle="true" type="topiclink" href="command_DECLARE" styleclass="Normal">DECLARE</link><text styleclass="Normal">, </text><link displaytype="text" defaultstyle="true" type="topiclink" href="command_PUBLIC" styleclass="Normal">PUBLIC</link></para>
    <para styleclass="" style="text-align:left; text-indent:0px; margin-top:0px; margin-right:16px; margin-bottom:0px; margin-left:12px; line-height:1.00; background-color:transparent; white-space:normal; page-break-inside:auto; page-break-after:auto; border:none; tabstops:64px left,320px left ;"></para>
  </body>
</topic>
