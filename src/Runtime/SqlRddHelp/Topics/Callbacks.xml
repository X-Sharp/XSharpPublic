<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../helpproject.xsl" ?>
<topic template="Default" modified="2024-02-27T17:43:31.140+01:00" lasteditedby="robert" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../helpproject.xsd">
  <title translate="true">Callbacks</title>
  <body>
    <header>
      <para styleclass="Heading1"><text styleclass="Heading1" translate="true">Callbacks</text></para>
    </header>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">Sometimes you may want to monitor the SQL commands that the RDD sends to the provider.</text></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">You can do that by registering an </text><link displaytype="text" defaultstyle="true" type="topiclink" href="html\E_XSharp_RDD_SqlRDD_SqlDbEventObject_CallBack.htm" domain="SqlRDDClasses.chm" styleclass="Normal" translate="true">Event Handler</link><text styleclass="Normal" translate="true"> that will be called for each statement sent to the server.</text><br/><text styleclass="Normal" translate="true">That event handler receives the sending object and an argument of type </text><link displaytype="text" defaultstyle="true" type="topiclink" href="html\Events_T_XSharp_RDD_SqlRDD_SqlDbEventObject.htm" domain="SqlRDDClasses.chm" styleclass="Normal" translate="true">SqlRddEventArgs</link><text styleclass="Normal" translate="true"> that describes what the RDD is doing or which information it wants:</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="Normal" translate="true">That may look like this:</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Code Example" style="margin-left:11px;"><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;" translate="true">function</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> TestTransaction()</text><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; &#160;</text><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:italic; text-decoration:none; color:#339966;" translate="true">// Tell the RDD to use the SQLServer SqlDbProvider class</text><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; &#160;</text><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:italic; text-decoration:none; color:#339966;" translate="true">// store the handle as hConn1</text><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; &#160;SqlDbSetProvider(</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#3366ff;" translate="true">&quot;SQLSERVER&quot;</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true">)</text><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; &#160;RddSetDefault(</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#3366ff;" translate="true">&quot;SQLRDD&quot;</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true">)</text><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; &#160;</text><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:italic; text-decoration:none; color:#339966;" translate="true">// Open a connection to the local Northwind sample database for SqlServer</text><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; &#160;</text><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:italic; text-decoration:none; color:#339966;" translate="true">// This connection will be the &apos;default&apos; connection</text><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; &#160;</text><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:italic; text-decoration:none; color:#339966;" translate="true">// store the handle as hConn1</text><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; &#160;</text><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;" translate="true">var</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> hConn1 := SqlDbOpenConnection(</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#3366ff;" translate="true">&quot;Server=(local);Initial catalog=Northwind;Trusted_Connection=True;&quot;</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true">)</text><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; &#160;</text><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;" translate="true">var</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> oConn1 := SqlDbGetConnection(hConn1)</text><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; &#160;</text><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:italic; text-decoration:none; color:#339966;" translate="true">// register an event handler</text><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; &#160;oConn1:CallBack += @@EventHandler</text><br/><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; &#160;</text><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:italic; text-decoration:none; color:#339966;" translate="true">// open a server</text><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; &#160;</text><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;" translate="true">var</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> oServer := DbServer{</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#3366ff;" translate="true">&quot;Customers&quot;</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true">}</text><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; &#160;oServer:GoTop()</text><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; &#160;</text><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:italic; text-decoration:none; color:#339966;" translate="true">// write to the server</text><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; &#160;oServer:FieldPut(</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#3366ff;" translate="true">#</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true">ContactName, </text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#3366ff;" translate="true">&quot;Jones&quot;</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true">)</text><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; &#160;</text><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:italic; text-decoration:none; color:#339966;" translate="true">// commit and close</text><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; &#160;oServer:Commit()</text><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; &#160;oServer:</text><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;" translate="true">Close</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true">()</text><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; &#160;SqlDbCloseConnection(hConn1)</text><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; &#160;</text><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;" translate="true">return</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> true</text><br/><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;" translate="true">FUNCTION</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> EventHandler(oSender </text><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;" translate="true">AS</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true">&#32;</text><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;" translate="true">Object</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true">, e </text><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;" translate="true">AS</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> XSharp.RDD.SqlRDD.SqlRddEventArgs) </text><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;" translate="true">AS</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true">&#32;</text><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;" translate="true">OBJECT</text><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; ? </text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#3366ff;" translate="true">&quot;Event&quot;</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true">, e:Table, e:Reason:ToString(), e:</text><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;" translate="true">Value</text><br/><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> &#160; </text><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;" translate="true">RETURN</text><text styleclass="Code Example" style="font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; color:#000000;" translate="true"> e:</text><text styleclass="Code Example" style="font-size:10pt; font-weight:bold; font-style:normal; text-decoration:none; color:#ff0000;" translate="true">Value</text></para>
    <para styleclass="Body Text"><text styleclass="Body Text" translate="true">This event handler will show the following for this example:</text></para>
    <para styleclass="Code Example"><text styleclass="Code Example" style="font-size:10pt;" translate="true">1) </text><tab /><text styleclass="Code Example" style="font-size:10pt;" translate="true">Event Customers CommandText select * from [Customers] where 0=1</text><br/><text styleclass="Code Example" style="font-size:10pt;" translate="true">2) </text><tab /><text styleclass="Code Example" style="font-size:10pt;" translate="true">Event Customers CommandText select [CustomerID], [CompanyName], [ContactName], [ContactTitle], </text><br/><tab /><tab /><text styleclass="Code Example" style="font-size:10pt;" translate="true">[Address], [City], [Region], [PostalCode], [Country], [Phone], [Fax] from [Customers] where 1=0</text><br/><text styleclass="Code Example" style="font-size:10pt;" translate="true">3) </text><tab /><text styleclass="Code Example" style="font-size:10pt;" translate="true">Event Customers WhereClause</text><br/><text styleclass="Code Example" style="font-size:10pt;" translate="true">4) </text><tab /><text styleclass="Code Example" style="font-size:10pt;" translate="true">Event Customers CommandText select top 1000 [CustomerID], [CompanyName], [ContactName], [ContactTitle],</text><br/><tab /><tab /><text styleclass="Code Example" style="font-size:10pt;" translate="true">[Address], [City], [Region], [PostalCode], [Country], [Phone], [Fax] from [Customers]</text><br/><text styleclass="Code Example" style="font-size:10pt;" translate="true">5) </text><tab /><text styleclass="Code Example" style="font-size:10pt;" translate="true">Event Customers CommandText update [Customers] set [ContactName] = @p1 where [CustomerID] = @o1; </text><br/><tab /><tab /><text styleclass="Code Example" style="font-size:10pt;" translate="true">select @@ROWCOUNT</text><br/></para>
    <para styleclass="Body Text"><text styleclass="Body Text" translate="true">You can see that the event handler is called first a couple of times:</text></para>
    <para styleclass="Body Text"></para>
    <para styleclass="List" style="text-indent:-88px; margin-left:88px;"><text styleclass="List" translate="true">1) </text><tab /><text styleclass="List" translate="true">To get the column list, </text></para>
    <para styleclass="List" style="text-indent:-88px; margin-left:88px;"><text styleclass="Body Text" translate="true">2) </text><tab /><text styleclass="List" translate="true">To select the full column information for all columns in the Customers Table. </text></para>
    <para styleclass="List" style="text-indent:-88px; margin-left:88px;"><text styleclass="List" translate="true">3)</text><tab /><text styleclass="List" translate="true">To query for a whereclause</text></para>
    <para styleclass="List" style="text-indent:-88px; margin-left:88px;"><text styleclass="List" translate="true">4)</text><tab /><text styleclass="List" translate="true">The Select statement that gets the data</text></para>
    <para styleclass="List" style="text-indent:-88px; margin-left:88px;"><text styleclass="List" translate="true">4)</text><tab /><text styleclass="List" translate="true">The update statement to update the table.</text><br/><text styleclass="List" translate="true">In this case the where clause contains just the CustomerId clause, because that was specified in the metadata provider for the table. And only the ContactName column is updated because UpdateAllColumns is set to FALSE by the metadata provider</text></para>
  </body>
</topic>
