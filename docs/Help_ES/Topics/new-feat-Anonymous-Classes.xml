<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../helpproject.xsl" ?>
<topic template="Default" lasteditedby="robert" version="2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../helpproject.xsd">
  <title>Anonymous Types</title>
  <body>
    <header>
      <para styleclass="Heading1">Anonymous Types</para>
    </header>
    <para styleclass="Normal">Anonymous types provide a convenient way to encapsulate a set of read-only properties into a single object without having to explicitly define a type first. <br/>The type name is generated by the compiler and is not available at the source code level. The type of each property is inferred by the compiler. </para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal">The syntax for an anonymous class is :</para>
    <para styleclass="Normal"></para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#3366ff;">VAR</text><text style="font-weight:normal; font-style:normal; color:#000000;"> o := </text><text style="font-weight:bold; font-style:normal; color:#3366ff;">CLASS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> { Name := </text><text style="font-weight:bold; font-style:normal; color:#993366;">&quot;test&quot;</text><text style="font-weight:normal; font-style:normal; color:#000000;">, Value := </text><text style="font-weight:bold; font-style:normal; color:#993366;">&quot;something&quot;</text><text style="font-weight:normal; font-style:normal; color:#000000;"> }</text></para>
    <para styleclass="Normal">In LINQ this may lead to:</para>
    <para styleclass="Normal"></para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#3366ff;">VAR</text><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160;result := </text><text style="font-weight:bold; font-style:normal; color:#3366ff;">from</text><text style="font-weight:normal; font-style:normal; color:#000000;"> c </text><text style="font-weight:bold; font-style:normal; color:#3366ff;">in</text><text style="font-weight:normal; font-style:normal; color:#000000;"> db.Customers </text><text style="font-weight:bold; font-style:normal; color:#3366ff;">where</text><text style="font-weight:normal; font-style:normal; color:#000000;"> c.Orders.Count &gt; 0 ;</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#3366ff;">select</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#3366ff;">CLASS</text><text style="font-weight:normal; font-style:normal; color:#000000;">{ ID := C.CustomerID, Name := C.CustomerName, OrderCount := C.Orders.Count}</text></para>
    <para styleclass="Body Text">In this case the object will have the properties <text style="font-weight:bold;">ID</text>, <text style="font-weight:bold;">Name</text> and <text style="font-weight:bold;">OrderCount</text> (all explicitely given)</para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal">If you select named properties from another object you can omit the &lt;Name&gt; := part. In that case the compiler will simply use the same name:</para>
    <para styleclass="Normal"></para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#3366ff;">VAR</text><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160;result := </text><text style="font-weight:bold; font-style:normal; color:#3366ff;">from</text><text style="font-weight:normal; font-style:normal; color:#000000;"> c </text><text style="font-weight:bold; font-style:normal; color:#3366ff;">in</text><text style="font-weight:normal; font-style:normal; color:#000000;"> db.Customers </text><text style="font-weight:bold; font-style:normal; color:#3366ff;">where</text><text style="font-weight:normal; font-style:normal; color:#000000;"> c.Orders.Count &gt; 0 ;</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#3366ff;">select</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#3366ff;">CLASS</text><text style="font-weight:normal; font-style:normal; color:#000000;">{ C.CustomerID, C.CustomerName, OrderCount := C.Orders.Count}</text></para>
    <para styleclass="Body Text"></para>
    <para styleclass="Body Text">In this case the anonymous class will have the properties <text style="font-weight:bold;">CustomerID</text>, <text style="font-weight:bold;">CustomerName</text> (inherited from C) and <text style="font-weight:bold;">OrderCount</text> (explicitely given)</para>
    <para styleclass="Body Text"></para>
    <para styleclass="Normal">Anonymous types contain one or more public read-only properties. No other kinds of class members, such as methods or events, are valid. <br/>The expression that is used to initialize a property cannot be null, an anonymous function, or a pointer type.</para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal">The most common scenario is to initialize an anonymous type with properties from another type. In the following example, assume that a class exists that is named Product. Class Product includes Color and Price properties, together with other properties that you are not interested in. Variable products is a collection of Product objects. The anonymous type declaration starts with the new keyword. The declaration initializes a new type that uses only two properties from Product. This causes a smaller amount of data to be returned in the query.</para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal">If you do not specify member names in the anonymous type, the compiler gives the anonymous type members the same name as the property being used to initialize them. You must provide a name for a property that is being initialized with an expression, as shown in the previous example. In the following example, the names of the properties of the anonymous type are Color and Price.</para>
    <para styleclass="Normal"></para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#3366ff;">var</text><text style="font-weight:normal; font-style:normal; color:#000000;"> productQuery := ;</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160;</text><text style="font-weight:bold; font-style:normal; color:#3366ff;">from</text><text style="font-weight:normal; font-style:normal; color:#000000;"> prod </text><text style="font-weight:bold; font-style:normal; color:#3366ff;">in</text><text style="font-weight:normal; font-style:normal; color:#000000;"> products ;</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160;</text><text style="font-weight:bold; font-style:normal; color:#3366ff;">select</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#3366ff;">CLASS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> { prod:Color, prod:Price }</text><br/><br/><text style="font-weight:bold; font-style:normal; color:#3366ff;">foreach</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#3366ff;">var</text><text style="font-weight:normal; font-style:normal; color:#000000;"> v </text><text style="font-weight:bold; font-style:normal; color:#3366ff;">in</text><text style="font-weight:normal; font-style:normal; color:#000000;"> productQuery</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160;Console.WriteLine(</text><text style="font-weight:bold; font-style:normal; color:#993366;">&quot;Color={0}, Price={1}&quot;</text><text style="font-weight:normal; font-style:normal; color:#000000;">, v:Color, v:Price)</text><br/><text style="font-weight:bold; font-style:normal; color:#3366ff;">next</text></para>
    <para styleclass="Normal">Typically, when you use an anonymous type to initialize a variable, you declare the variable as an implicitly typed local variable by using var. The type name cannot be specified in the variable declaration because only the compiler has access to the underlying name of the anonymous type.</para>
    <para styleclass="Heading2">Remarks</para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal">Anonymous types are class types that derive directly from object, and that cannot be cast to any type except object. The compiler provides a name for each anonymous type, although your application cannot access it. From the perspective of the common language runtime (CLR), an anonymous type is no different from any other reference type.</para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal">If two or more anonymous object initializers in an assembly specify a sequence of properties that are in the same order and that have the same names and types, the compiler treats the objects as instances of the same type. They share the same compiler-generated type information.</para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal">You cannot declare a field, a property, an event, or the return type of a method as having an anonymous type. Similarly, you cannot declare a formal parameter of a method, property, constructor, or indexer as having an anonymous type. To pass an anonymous type, or a collection that contains anonymous types, as an argument to a method, you can declare the parameter as type object. However, doing this defeats the purpose of strong typing. If you must store query results or pass them outside the method boundary, consider using an ordinary named struct or class instead of an anonymous type.</para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal">Because the Equals and GetHashCode methods on anonymous types are defined in terms of the Equals and GetHashCode methods of the properties, two instances of the same anonymous type are equal only if all their properties are equal.</para>
    <para styleclass="Normal"></para>
  </body>
</topic>
