<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../helpproject.xsl" ?>
<topic template="Default" lasteditedby="robert" version="2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../helpproject.xsd">
  <title>Workarea Events</title>
  <body>
    <header>
      <para styleclass="Heading1">Workarea Events</para>
    </header>
    <para styleclass="Normal">In build 2.08 we have added the option to register an event handler that receives workarea events. This can be used to monitor access to workareas and for example write this information to a log file.</para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal">There are 2 ways to install this event handler:</para>
    <list id="26" type="ol" listtype="decimal" formatstring="&#37;&#48;&#58;&#115;&#46;" format-charset="DEFAULT_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Body Text" style="font-family:Arial; font-size:11pt; color:#000000;">
      <li styleclass="Body Text"><text styleclass="Normal">You create a function/ method that implements </text>the <link displaytype="text" defaultstyle="true" type="topiclink" href="html\T_XSharp_DbNotifyEventHandler.htm" domain="XsRuntime.chm">DbNotifyEventHandler</link>&#32;delegate.<br/><br/><text styleclass="" style="font-family:Consolas; font-size:9pt; color:#0000ff;">PUBLIC</text><text styleclass="" style="font-family:Consolas; font-size:9pt; color:#000000;">&#32;</text><text styleclass="" style="font-family:Consolas; font-size:9pt; color:#0000ff;">DELEGATE</text><text styleclass="" style="font-family:Consolas; font-size:9pt; color:#000000;"> XSharp.DbNotifyEventHandler(osender </text><text styleclass="" style="font-family:Consolas; font-size:9pt; color:#0000ff;">AS</text><text styleclass="" style="font-family:Consolas; font-size:9pt; color:#000000;"> XSharp.RDD.IRDD, e </text><text styleclass="" style="font-family:Consolas; font-size:9pt; color:#0000ff;">AS</text><text styleclass="" style="font-family:Consolas; font-size:9pt; color:#000000;"> XSharp.DBNotifyEventArgs) </text><text styleclass="" style="font-family:Consolas; font-size:9pt; color:#0000ff;">AS</text><text styleclass="" style="font-family:Consolas; font-size:9pt; color:#000000;">&#32;</text><text styleclass="" style="font-family:Consolas; font-size:9pt; color:#0000ff;">VOID</text><br/></li>
      <li styleclass="Body Text">You create a class that implements the <link displaytype="text" defaultstyle="true" type="topiclink" href="html\T_XSharp_IDbNotify.htm" domain="XsRuntime.chm">IDbnotify</link> interface, which only has a method named Notify() with the same prototype as the delegate from 1)</li>
    </list>
    <para styleclass="Heading1">Important</para>
    <list id="27" type="ul" listtype="bullet" formatstring="&#183;" format-charset="SYMBOL_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Normal" style="font-family:Symbol; font-size:11pt; color:#000000;">
      <li styleclass="Normal">Your event handler should do as little as possible if you don&apos;t want to slow down the whole RDD system.</li>
      <li styleclass="Normal">Do not manipulate any workareas from within your event handler to avoid recursion.</li>
      <li styleclass="Normal">Unregister your event handler as soon as possible.</li>
      <li styleclass="Normal">If you use an object for event handling you are responsible yourself to manage the life time of this object. And be sure to unregister the object before it runs out of scope</li>
      <li styleclass="Normal">In some cases (operations that work on more than one workarea, such as DbCommitAll() , DbUnLockAll() ) &#160;the event handler will not always receive a sender parameter. Be prepared for that !</li>
      <li styleclass="Normal">The events are sent from the CoreDb level. So if a method inside an RDD calls another method inside that RDD (for example CreateOrder() might call GoTop() after creating the order) then you will not see that second event, only the events related to the method that was called from the CoreDb() level, so the events related to the Ordercreation in this example.</li>
    </list>
    <para styleclass="Heading1">Examples</para>
    <para styleclass="Body Text"></para>
    <para styleclass="Body Text">If you use approach 1 then you need to add the event handler to CoreDb.Notify like in the following example:</para>
    <para styleclass="Body Text"></para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#ff0000;">FUNCTION</text><text style="font-weight:normal; font-style:normal; color:#000000;"> NotifyRDDOperations(oRDD </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> XSharp.RDD.IRdd, oEvent </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> XSharp.DbNotifyEventArgs) </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">VOID</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">IF</text><text style="font-weight:normal; font-style:normal; color:#000000;"> oRDD != </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">NULL</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; &#160; &#160;? oRDD:Alias, oEvent:Type:ToString(), oEvent:Data</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">ELSE</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; &#160; &#160;? &quot;(no area)&quot;,oEvent:Type:ToString(), oEvent:Data</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">ENDIF</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">RETURN</text><br/><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">FUNCTION</text><text style="font-weight:normal; font-style:normal; color:#000000;"> Start() </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">VOID</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; CoreDb.Notify += NotifyRDDOperations</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160;? DbCreate(&quot;Test&quot;, {{&quot;FLD1&quot; , &quot;C&quot; , 10 , 0} }) &#160; &#160;</text><text style="font-weight:bold; font-style:italic; color:#339966;">// This will trigger a notification</text><br/><tab /><text style="font-weight:normal; font-style:normal; color:#000000;">CoreDb.Notify -= NotifyRDDOperations</text><tab /><tab /><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160;</text><text style="font-weight:bold; font-style:italic; color:#339966;">// Do not forget to unregister!</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">WAIT</text><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">RETURN</text></para>
    <para styleclass="Body Text">The parameters to the function are:</para>
    <para styleclass="List"><text styleclass="Body Text">oRDD</text><tab /><text styleclass="Body Text">The RDD for which the event is triggered. This may be NULL for events that involve multiple workareas, such as DbUnlockAll()</text></para>
    <para styleclass="List"><text styleclass="Body Text">oEvent</text><tab /><text styleclass="Body Text">An event handler object that has 2 properties</text></para>
    <para styleclass="List"><tab /><text styleclass="Body Text">Type</text><tab /><text styleclass="Body Text">A Value of the </text><link displaytype="text" defaultstyle="true" type="topiclink" href="html\T_XSharp_RDD_Enums_DbNotificationType.htm" domain="XsRuntime.chm" styleclass="Body Text">DbNotificationType</link><text styleclass="Body Text">&#32;</text><text styleclass="Body Text">enum</text></para>
    <para styleclass="List"><tab /><text styleclass="Body Text">Data</text><tab /><text styleclass="Body Text">An object that has additional information about the event, such as the fieldname for a PieldPut and the recordnumber for a Append or Delete event..</text></para>
    <para styleclass="List"></para>
    <para styleclass="Body Text">For the second approach you create a class and register the class with the <link displaytype="text" defaultstyle="true" type="topiclink" href="html\M_XSharp_Core_Functions_DbRegisterClient.htm" domain="XsRuntime.chm">DbRegisterClient</link>() function and unregister the class with the <link displaytype="text" defaultstyle="true" type="topiclink" href="html\M_XSharp_Core_Functions_DbUnRegisterClient.htm" domain="XsRuntime.chm">DbUnRegisterClient</link>&#32;function</para>
    <para styleclass="Body Text">The method in the class will get the same arguments as the event handler function:</para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#ff0000;">CLASS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> Notifier </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">IMPLEMENTS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> IDbnotify</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">METHOD</text><text style="font-weight:normal; font-style:normal; color:#000000;"> Notify(oRDD </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> XSharp.RDD.IRdd, oEvent </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> XSharp.DbNotifyEventArgs) </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">VOID</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">IF</text><text style="font-weight:normal; font-style:normal; color:#000000;"> oRDD != </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">NULL</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; &#160; &#160; &#160;? oRDD:Alias, oEvent:Type:ToString(), oEvent:Data</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">ELSE</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; &#160; &#160; &#160;? &quot;(no area)&quot;,oEvent:Type:ToString(), oEvent:Data</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">ENDIF</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">RETURN</text><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">END</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">CLASS</text><br/><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">FUNCTION</text><text style="font-weight:normal; font-style:normal; color:#000000;"> Start() </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">VOID</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">LOCAL</text><text style="font-weight:normal; font-style:normal; color:#000000;"> oNot </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> Notifier</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; oNot := Notifier{}</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; DbRegisterClient(oNot) &#160; </text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; ? DbCreate(&quot;Test&quot;, {{&quot;FLD1&quot; , &quot;C&quot; , 10 , 0} }) &#160; &#160;</text><text style="font-weight:bold; font-style:italic; color:#339966;">// This will trigger a notification</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; DbUnRegisterClient(oNot) &#160;</text><tab /><tab /><tab /><tab /><text style="font-weight:bold; font-style:italic; color:#339966;">// Do not forget to unregister!</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><tab /><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">WAIT</text><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">RETURN</text></para>
    <para styleclass="Body Text"></para>
    <para styleclass="Body Text"></para>
    <para styleclass="Heading1">See Also</para>
    <para styleclass="Body Text"><link displaytype="text" defaultstyle="true" type="topiclink" href="html\T_XSharp_RDD_Enums_DbNotificationType.htm" domain="XsRuntime.chm">DbNotificationType</link>&#32;</para>
    <para styleclass="Body Text"><link displaytype="text" defaultstyle="true" type="topiclink" href="html\M_XSharp_Core_Functions_DbRegisterClient.htm" domain="XsRuntime.chm">DbRegisterClient</link>()</para>
    <para styleclass="Body Text"><link displaytype="text" defaultstyle="true" type="topiclink" href="html\M_XSharp_Core_Functions_DbUnRegisterClient.htm" domain="XsRuntime.chm">DbUnRegisterClient</link></para>
    <para styleclass="Body Text"><link displaytype="text" defaultstyle="true" type="topiclink" href="html\T_XSharp_DbNotifyEventHandler.htm" domain="XsRuntime.chm">DbNotifyEventHandler</link></para>
    <para styleclass="Body Text"><link displaytype="text" defaultstyle="true" type="topiclink" href="html\T_XSharp_IDbNotify.htm" domain="XsRuntime.chm">IDbnotify</link>&#32;</para>
    <para styleclass="Body Text"></para>
  </body>
</topic>
