<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../helpproject.xsl" ?>
<topic template="Default" modified="2024-07-26T11:36:51.578+08:00" lasteditedby="niuji" version="2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../helpproject.xsd">
  <title>VOSTRUCT 语句</title>
  <keywords>
    <keyword>ALIGN</keyword>
    <keyword>Aligning<keyword>structure members</keyword></keyword>
    <keyword>Alignment of structures</keyword>
    <keyword>Compiletime declaration</keyword>
    <keyword>Data structures<keyword>alignment</keyword><keyword>declaring</keyword><keyword>specifying members</keyword></keyword>
    <keyword>Declaration statements</keyword>
    <keyword>END VOSTRUCT</keyword>
    <keyword>Entity declaration</keyword>
    <keyword>MEMBER clause</keyword>
    <keyword>Statements</keyword>
    <keyword>STATIC VOSTRUCT statement</keyword>
    <keyword>Structure<keyword>Alignment</keyword></keyword>
    <keyword>VOSTRUCT</keyword>
    <keyword>VOSTRUCT statement</keyword>
  </keywords>
  <body>
    <header>
      <para styleclass="Heading1">VOSTRUCT 语句</para>
    </header>
    <para styleclass="Heading1"><snippet src="__VoVulcanOnly" inline="false"/></para>
    <para styleclass="Heading1">用途</para>
    <para styleclass="Body Text">声明数据结构及其成员名称。</para>
    <para styleclass="Heading1">语法</para>
    <para styleclass="Normal">[Modifiers] VOSTRUCT &lt;<text styleclass="Italic">idStructure</text>&gt; [ALIGN 1|2|4|8]</para>
    <para styleclass="Normal"><tab />MEMBER &lt;<text styleclass="Italic">idVarList</text>&gt; AS | IS &lt;<text styleclass="Italic">idType</text>&gt; [, ...] </para>
    <para styleclass="Normal"><tab />MEMBER DIM &lt;<text styleclass="Italic">ArraySpec</text>&gt; [, ...] AS | IS &lt;<text styleclass="Italic">idType</text>&gt; [, ...] </para>
    <para styleclass="Normal">[END VOSTRUCT]</para>
    <para styleclass="Normal"></para>
    <para styleclass="Body Text"><text styleclass="Bold" style="font-family:Arial; font-size:10pt; font-weight:normal; font-style:normal; text-transform:none; vertical-align:baseline; color:#000000; background-color:transparent; letter-spacing:normal; letter-scaling:100%;">注：为方便起见，MEMBER 语句使用了两个语法。 如果每个定义之间用逗号隔开，则可以使用单个 MEMBER 语句声明变量和标度数组。</text></para>
    <para styleclass="Heading1">参数</para>
    <para styleclass="List"><snippet src="__IncludeFuncProcModifiers" inline="false"/></para>
    <para styleclass="List"></para>
    <para styleclass="List">&lt;idStructure&gt;<tab />结构体的有效标识符名称。 结构体是一个实体，与其他实体共享相同的名称空间。 这意味着不可能出现结构和常量同名的情况。</para>
    <para styleclass="List"></para>
    <para styleclass="List">MEMBER<tab />声明一个或多个结构成员变量或标度数组。 您可以在不同行中指定多个 MEMBER 声明。</para>
    <para styleclass="List"></para>
    <para styleclass="List">&lt;idVarList&gt;<tab />以逗号分隔的结构成员变量标识符名称列表。</para>
    <para styleclass="List"></para>
    <para styleclass="List">DIM &lt;ArraySpec&gt;<tab />作为结构成员使用的有维数组的规格。 &lt;ArraySpec&gt; 是以下格式之一：</para>
    <para styleclass="List"><tab />&lt;idArray&gt;[&lt;nElements&gt;, &lt;nElements&gt;, &lt;nElements&gt;]</para>
    <para styleclass="List"><tab />&lt;idArray&gt;[&lt;nElements&gt;][&lt;nElements&gt;][&lt;nElements&gt;]</para>
    <para styleclass="List"><tab /></para>
    <para styleclass="List"><tab />除了第一个维度外，所有维度都是可选的。</para>
    <para styleclass="List"></para>
    <para styleclass="List"><tab />&lt;idArray&gt; 是要声明的数组的有效标识符名称。</para>
    <para styleclass="List"></para>
    <para styleclass="List"><tab />&lt;nElements&gt; 定义数组特定维数中的元素个数。 维数由指定 &lt;nElements&gt; 参数的个数决定。</para>
    <para styleclass="List"></para>
    <para styleclass="List"><tab />&lt;nElements&gt; 可以是字面数字表示或只涉及运算符、字面数字和 DEFINE 常量的简单数字表达式；但不允许使用更复杂的表达式(如函数调用)。</para>
    <para styleclass="List"></para>
    <para styleclass="List">AS &lt;idType&gt;<tab />指定所声明变量的数据类型(称为<link displaytype="text" defaultstyle="true" type="topiclink" href="Strong-Typing" styleclass="Normal">强类型</link>)。 对于 DIM 数组，声明所有数组元素的数据类型。 所有结构成员都需要 AS &lt;idType&gt;。</para>
    <para styleclass="List"></para>
    <para styleclass="List"><tab />有关 &lt;idType&gt; 的有效值列表，请参阅 CLASS 条目。 请注意，结构中不支持以下数据类型，因为它们是需要垃圾回收的动态类型：</para>
    <para styleclass="List"><tab />ARRAY</para>
    <para styleclass="List"><tab />FLOAT<tab /></para>
    <para styleclass="List"><tab />OBJECT</para>
    <para styleclass="List"><tab />&lt;idClass&gt;</para>
    <para styleclass="List"><tab />STRING</para>
    <para styleclass="List"><tab />USUAL</para>
    <para styleclass="List"></para>
    <para styleclass="List">IS &lt;idType&gt;<tab />指定一种结构体数据类型，在这种数据类型中，保存结构体所需的内存是在堆栈中分配的(也就是说，&lt;idStructure&gt; 是唯一允许使用 IS 关键字的 &lt;idType&gt;)。</para>
    <para styleclass="List"></para>
    <para styleclass="List">ALIGN 1|2|4|8<tab />指定结构体的内存对齐方式。默认对齐方式基于结构成员的大小。请参见下面关于对齐方式的段落。</para>
    <para styleclass="List"><tab />当您需要匹配一个定义了不同对齐方式(C/C++ 头文件中的 #pragma pack)的 C/C++ 结构时，可能需要更改对齐方式。</para>
    <para styleclass="List"><tab />.</para>
    <para styleclass="Heading1">备注</para>
    <para styleclass="Normal"><text styleclass="BoldItalic" style="font-family:Arial; font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; text-transform:none; vertical-align:baseline; color:#000000; background-color:transparent; letter-spacing:normal; letter-scaling:100%;">AS 与 IS： &#160;一旦定义了结构体，就可以使用结构体的名称来声明变量（参见本指南中的 GLOBAL 和 LOCAL 语句），以保存特定结构体的实例。 在声明结构变量时，可以选择使用 AS 或 IS 类型。 这两种声明方法的区别如下：</text></para>
    <list id="0" type="ul" listtype="bullet" formatstring="&#183;" format-charset="SYMBOL_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Indented" style="text-align:left; text-indent:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; line-height:1.00; background-color:transparent; white-space:normal; page-break-inside:auto; page-break-after:auto; border:none; tabstops:none; font-family:Symbol; font-size:11pt; color:#000000;">
      <li styleclass="Indented" style="text-align:left; text-indent:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; line-height:1.00; background-color:transparent; white-space:normal; page-break-inside:auto; page-break-after:auto; border:none; tabstops:none;"><tab /><text styleclass="Normal">IS 会自动分配在堆栈中存放结构所需的内存，并在声明实体返回时重新分配内存。</text></li>
      <li styleclass="Indented" style="text-align:left; text-indent:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; line-height:1.00; background-color:transparent; white-space:normal; page-break-inside:auto; page-break-after:auto; border:none; tabstops:none;"><tab /><text styleclass="Normal">AS 要求在初始化结构变量时使用 MemAlloc() 分配内存。 在声明实体返回之前，还必须使用 MemFree() 注销结构变量使用的内存。</text></li>
    </list>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="BoldItalic" style="font-family:Arial; font-size:10pt; font-weight:normal; font-style:italic; text-decoration:none; text-transform:none; vertical-align:baseline; color:#000000; background-color:transparent; letter-spacing:normal; letter-scaling:100%;">重要！ IS 类型比 AS 类型简单得多，而且在大多数情况下都能满足使用结构的要求。 AS 类型推荐给有经验的系统程序员，因为他们会因为各种原因反对以这种方式使用堆栈。</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Normal"><text styleclass="BoldItalic" style="font-family:Arial; font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; text-transform:none; vertical-align:baseline; color:#000000; background-color:transparent; letter-spacing:normal; letter-scaling:100%;">分配子结构：结构体的一个有趣特性是，它可以包含其他结构体作为成员，但如果使用 AS 键入这些子结构体，就必须为它们分配和取消分配内存。 无论包含的结构是用 AS 还是 IS 键入，情况都是如此：</text></para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#ff0000;">VOSTRUCT</text><text style="font-weight:normal; font-style:normal; color:#000000;"> SysOne</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> iAlpha </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">INT</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> pszName </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">PSZ</text><br/><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">VOSTRUCT</text><text style="font-weight:normal; font-style:normal; color:#000000;"> SysTwo</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> iBeta </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">INT</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> strucOne </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> SysOne</text><br/><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">FUNCTION</text><text style="font-weight:normal; font-style:normal; color:#000000;"> UseStruct()</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">LOCAL</text><text style="font-weight:normal; font-style:normal; color:#000000;"> strucVar </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> SysTwo</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; strucVar := MemAlloc(_SizeOf(SysTwo))</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; strucVar.strucOne := MemAlloc(_SizeOf(SysOne))</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; ...</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; MemFree(strucVar.strucOne)</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; MemFree(strucVar)</text></para>
    <para styleclass="Normal">为了简化编程，使用 IS 声明子结构是合理的。 然后，子结构的内存将与其包含结构的内存一起分配和清空：</para>
    <para styleclass="Code Example"><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">VOSTRUCT</text><text style="font-weight:normal; font-style:normal; color:#000000;"> SysTwo</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> iBeta &#160; &#160;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">INT</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> strucOne &#160; &#160;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">IS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> SysOne</text><br/><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">FUNCTION</text><text style="font-weight:normal; font-style:normal; color:#000000;"> UseStruct()</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">LOCAL</text><text style="font-weight:normal; font-style:normal; color:#000000;"> strucVar </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> SysTwo</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; strucVar := MemAlloc(_SizeOf(SysTwo))</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; ...</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; MemFree(strucVar)</text></para>
    <para styleclass="Normal"><text styleclass="BoldItalic" style="font-family:Arial; font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; text-transform:none; vertical-align:baseline; color:#000000; background-color:transparent; letter-spacing:normal; letter-scaling:100%;">访问结构成员：结构变量是一个复杂的变量，由结构中声明的成员组成。 要访问结构成员，请使用点运算符(</text><text styleclass="BoldItalic" style="font-family:Arial; font-size:10pt; font-weight:bold; font-style:normal; text-decoration:none; text-transform:none; vertical-align:baseline; color:#000000; background-color:transparent; letter-spacing:normal; letter-scaling:100%;">.</text><text styleclass="BoldItalic" style="font-family:Arial; font-size:10pt; font-weight:normal; font-style:normal; text-decoration:none; text-transform:none; vertical-align:baseline; color:#000000; background-color:transparent; letter-spacing:normal; letter-scaling:100%;">)，如下所示：</text></para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#000000;">&lt;</text><text style="font-weight:normal; font-style:normal; color:#000000;">idStructVar&gt;.&lt;idMember&gt;</text></para>
    <para styleclass="Normal">其中，&lt;idStructVar&gt; 是先前使用结构名声明的变量名或标度数组元素，&lt;idMember&gt; 是在 VOSTRUCT 定义中作为成员声明的变量名或标度数组元素。</para>
    <para styleclass="Normal"></para>
    <para styleclass="Heading1">示例</para>
    <para styleclass="Normal">本例说明 IS 结构类型。无需分配，但必须通过引用将结构传递给调用。</para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#ff0000;">VOSTRUCT</text><text style="font-weight:normal; font-style:normal; color:#000000;"> SysOne &#160; &#160; &#160;</text><text style="font-weight:bold; font-style:italic; color:#339966;">// 定义 SysOne 数据结构</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> iAlpha </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">INT</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> pszName </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">PSZ</text><br/><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">FUNCTION</text><text style="font-weight:normal; font-style:normal; color:#000000;"> Tester(strucSysOne </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> SysOne) </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">INT</text><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">RETURN</text><text style="font-weight:normal; font-style:normal; color:#000000;"> strucSysOne.iAlpha</text><br/><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">FUNCTION</text><text style="font-weight:normal; font-style:normal; color:#000000;"> UseStruct()</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">LOCAL</text><text style="font-weight:normal; font-style:normal; color:#000000;"> strucVar </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">IS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> SysOne</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; strucVar.iAlpha := 100</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; ? Tester(@strucVar) &#160; </text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; ...</text></para>
    <para styleclass="Normal">本例说明 AS 结构类型。这需要分配和删除内存：</para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#ff0000;">VOSTRUCT</text><text style="font-weight:normal; font-style:normal; color:#000000;"> SysOne &#160; &#160; &#160;</text><text style="font-weight:bold; font-style:italic; color:#339966;">// 定义 SysOne 数据结构</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> iAlpha </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">INT</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> pszName </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">PSZ</text><br/><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">FUNCTION</text><text style="font-weight:normal; font-style:normal; color:#000000;"> Tester(strucSysOne </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> SysOne) </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">INT</text><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">RETURN</text><text style="font-weight:normal; font-style:normal; color:#000000;"> strucSysOne.iAlpha</text><br/><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">FUNCTION</text><text style="font-weight:normal; font-style:normal; color:#000000;"> UseStruct()</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">LOCAL</text><text style="font-weight:normal; font-style:normal; color:#000000;"> strucVar </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> SysOne</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; strucVar := MemAlloc(_SizeOf(SysOne))</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; strucVar.iAlpha := 100</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; ? Tester(strucVar) &#160; </text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; ...</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; MemFree(strucVar)</text></para>
    <para styleclass="Normal">使用 MEMBER，可以列出几组变量名和数组名，中间用逗号隔开，后面跟一个 AS | IS &lt;idType&gt; 子句，表示所有列出的变量名和数组名都要按指定的方式键入。 在本例中，变量 x 和数组 z 的类型为 INT，而变量 ptrX 和 ptrY 的类型为 PTR。</para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#ff0000;">VOSTRUCT</text><text style="font-weight:normal; font-style:normal; color:#000000;"> SysOne &#160; &#160; &#160;</text><text style="font-weight:bold; font-style:italic; color:#339966;">// 定义 SysOne 数据结构</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> x, </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">DIM</text><text style="font-weight:normal; font-style:normal; color:#000000;"> z[100] </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">INT</text><text style="font-weight:normal; font-style:normal; color:#000000;">, ptrX, ptrY </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">PTR</text></para>
    <para styleclass="Normal"></para>
    <para styleclass="Heading1">默认 VoStruct 对齐</para>
    <para styleclass="Normal">您可以选择在结构定义中指定对齐子句，或者让 &lt;%app%&gt; 为您确定最佳对齐方式。</para>
    <para styleclass="Normal">默认对齐方式使用以下机制：</para>
    <list id="1" type="ul" listtype="bullet" formatstring="&#183;" format-charset="SYMBOL_CHARSET" levelreset="true" legalstyle="false" startfrom="1" styleclass="Normal" style="font-family:Symbol; font-size:11pt; color:#000000;">
      <li styleclass="Normal">每个大小 &lt;= 8 的成员在结构体内部获得的内存地址都是其大小的倍数。因此，WORD 和 SHORT 成员按 EVEN 边界对齐，DWORD、LONG、PTR、PSZ 成员按 4 字节边界对齐，REAL8 成员按 8 字节边界对齐。字节成员不对齐，它们可以出现在结构中的任何地方。</li>
      <li styleclass="Normal">结构的总大小与最大成员的大小对齐。这样做是为了确保结构的 dim 数组(内存中相邻的多个结构)也能正确对齐</li>
      <li styleclass="Normal">当一个结构包含一个子结构（IS 声明）时，外部结构的对齐将使用内部结构的信息。</li>
    </list>
    <para styleclass="Normal"></para>
    <para styleclass="Normal">手动(显式)对齐时，结构的每个元素都会对齐到指定对齐倍数的内存地址。</para>
    <para styleclass="Normal"></para>
    <para styleclass="Bold" style="text-align:left; text-indent:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; line-height:1.00; background-color:transparent; white-space:normal; page-break-inside:auto; page-break-after:auto; border:none; tabstops:none;"><text style="font-family:Arial; font-size:10pt; font-weight:normal; font-style:normal; text-transform:none; vertical-align:baseline; color:#000000; background-color:transparent; letter-spacing:normal; letter-scaling:100%;">自动对齐的一些示例：</text></para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#ff0000;">VOSTRUCT</text><text style="font-weight:normal; font-style:normal; color:#000000;"> test1 &#160; &#160; &#160; &#160; &#160; &#160; &#160;</text><text style="font-weight:bold; font-style:italic; color:#339966;">// Offset </text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> W &#160;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> WORD &#160; &#160; &#160; &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 0</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> dw </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">DWORD</text><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; &#160; &#160;</text><text style="font-weight:bold; font-style:italic; color:#339966;">// 4</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> b &#160;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> BYTE &#160; &#160; &#160; &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 8</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 结构总大小 = 12 字节(最大元素 = 4，因此填充为 12)</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 结构的内存布局</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 0123|4567|8901</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// WW..|DWDW|B...</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// </text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// WW &#160; = Word</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// DWDW = Dword</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// B &#160; &#160;= Byte</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// . &#160; &#160;= Padding</text><br/><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">VOSTRUCT</text><text style="font-weight:normal; font-style:normal; color:#000000;"> test1 &#160; &#160; &#160; &#160; &#160; &#160; &#160;</text><text style="font-weight:bold; font-style:italic; color:#339966;">// Offset</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> W &#160;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> WORD &#160; &#160; &#160; &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 0</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> r8 </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">REAL8</text><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; &#160; &#160;</text><text style="font-weight:bold; font-style:italic; color:#339966;">// 8</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> b &#160;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> BYTE &#160; &#160; &#160; &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 16</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 结构总大小 = 24 字节(最大元素 = 8，因此填充为 24)</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 结构的内存布局</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 01234567|89012345|67890123</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// WW......|R8R8R8R8|B.......</text></para>
    <para styleclass="Bold" style="text-align:left; text-indent:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; line-height:1.00; background-color:transparent; white-space:normal; page-break-inside:auto; page-break-after:auto; border:none; tabstops:none;"></para>
    <para styleclass="Heading1">显式(手动)结构对齐</para>
    <para styleclass="Normal">在某些情况下，您需要从 C/C++ 头文件中匹配一个具有显式对齐方式的结构声明。这时需要在结构声明中添加 ALIGN 子句。</para>
    <para styleclass="Normal">这将强制编译器将结构元素对齐到指定大小的倍数。</para>
    <para styleclass="Normal">如果对齐值为 1，编译器就不会使用填充，而是将结构中的所有元素紧挨着对齐。这是最紧凑的方法，但速度可能较慢。</para>
    <para styleclass="Normal"></para>
    <para styleclass="Bold" style="text-align:left; text-indent:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; line-height:1.00; background-color:transparent; white-space:normal; page-break-inside:auto; page-break-after:auto; border:none; tabstops:none;"><text style="font-family:Arial; font-size:10pt; font-weight:normal; font-style:normal; text-transform:none; vertical-align:baseline; color:#000000; background-color:transparent; letter-spacing:normal; letter-scaling:100%;">显示对齐的一些例子</text></para>
    <para styleclass="Code Example"><text style="font-weight:bold; font-style:normal; color:#ff0000;">VOSTRUCT</text><text style="font-weight:normal; font-style:normal; color:#000000;"> test1 ALIGN 1 &#160; &#160; &#160;</text><text style="font-weight:bold; font-style:italic; color:#339966;">// Offset</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> W &#160;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> WORD &#160; &#160; &#160; &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 0</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> r8 </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">DWORD</text><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; &#160; &#160;</text><text style="font-weight:bold; font-style:italic; color:#339966;">// 2</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> b &#160;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> BYTE &#160; &#160; &#160; &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 6</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 结构总大小 = 7 字节(1 的倍数)</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 结构的内存布局</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 01|2345|6</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// WW|DWDW|B</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">//</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// WW &#160; = Word</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// DWDW = Dword</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// B &#160; &#160;= Byte</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// . &#160; &#160;= Padding</text><br/><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">VOSTRUCT</text><text style="font-weight:normal; font-style:normal; color:#000000;"> test1 ALIGN 2 &#160; &#160; &#160;</text><text style="font-weight:bold; font-style:italic; color:#339966;">// Offset </text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> W &#160;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> WORD &#160; &#160; &#160; &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 0</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> dw </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">DWORD</text><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; &#160; &#160;</text><text style="font-weight:bold; font-style:italic; color:#339966;">// 2</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> b &#160;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> BYTE &#160; &#160; &#160; &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 6</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 结构总大小 = 8 字节(2 的倍数)</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 结构的内存布局</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 01|23|45|67</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// WW|DW|DW|B.</text><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">VOSTRUCT</text><text style="font-weight:normal; font-style:normal; color:#000000;"> test1 ALIGN 4 &#160; &#160; &#160;</text><text style="font-weight:bold; font-style:italic; color:#339966;">// Offset </text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> W &#160;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> WORD &#160; &#160; &#160; &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 0</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> r8 </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">DWORD</text><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; &#160; &#160;</text><text style="font-weight:bold; font-style:italic; color:#339966;">// 4</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> b &#160;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> BYTE &#160; &#160; &#160; &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 8</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 结构总大小 = 12 字节(4 的倍数)</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 结构的内存布局</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 0123|4567|8901</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// WW..|DWDW|B...</text><br/><br/><text style="font-weight:bold; font-style:normal; color:#ff0000;">VOSTRUCT</text><text style="font-weight:normal; font-style:normal; color:#000000;"> test1 ALIGN 8 &#160; &#160; &#160;</text><text style="font-weight:bold; font-style:italic; color:#339966;">// Offset</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> W &#160;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> WORD &#160; &#160; &#160; &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 0</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> r8 </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;">&#32;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">DWORD</text><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; &#160; &#160; &#160;</text><text style="font-weight:bold; font-style:italic; color:#339966;">// 8</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:normal; color:#ff0000;">MEMBER</text><text style="font-weight:normal; font-style:normal; color:#000000;"> b &#160;</text><text style="font-weight:bold; font-style:normal; color:#ff0000;">AS</text><text style="font-weight:normal; font-style:normal; color:#000000;"> BYTE &#160; &#160; &#160; &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 16</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 结构总大小 = 24 字节(8 的倍数)</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 结构的内存布局</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// 01234567|89012345|67890123</text><br/><text style="font-weight:normal; font-style:normal; color:#000000;"> &#160; </text><text style="font-weight:bold; font-style:italic; color:#339966;">// WW......|DWDW....|B.......</text></para>
    <para styleclass="Heading1">参见</para>
    <para styleclass="Normal"><link displaytype="text" defaultstyle="true" type="topiclink" href="command_GLOBAL">GLOBAL</link><text styleclass="Bold" style="font-family:Arial; font-size:10pt; font-weight:normal; font-style:normal; text-transform:none; vertical-align:baseline; color:#000000; background-color:transparent; letter-spacing:normal; letter-scaling:100%;">, </text><link displaytype="text" defaultstyle="true" type="topiclink" href="command_LOCAL">LOCAL</link><text styleclass="Bold" style="font-family:Arial; font-size:10pt; font-weight:normal; font-style:normal; text-transform:none; vertical-align:baseline; color:#000000; background-color:transparent; letter-spacing:normal; letter-scaling:100%;">, </text><link displaytype="text" defaultstyle="true" type="topiclink" href="html\M_XSharp_RT_Functions_MemAlloc.htm" domain="XSharpRef.chm">MemAlloc()</link><text styleclass="Bold" style="font-family:Arial; font-size:10pt; font-weight:normal; font-style:normal; text-transform:none; vertical-align:baseline; color:#000000; background-color:transparent; letter-spacing:normal; letter-scaling:100%;">, </text><link displaytype="text" defaultstyle="true" type="topiclink" href="html\M_XSharp_RT_Functions_MemFree.htm" domain="XSharpRef.chm">MemFree()</link><text styleclass="Bold" style="font-family:Arial; font-size:10pt; font-weight:normal; font-style:normal; text-transform:none; vertical-align:baseline; color:#000000; background-color:transparent; letter-spacing:normal; letter-scaling:100%;">,, </text><link displaytype="text" defaultstyle="true" type="topiclink" href="command_UNION">UNION</link></para>
    <para styleclass="" style="text-align:left; text-indent:0px; margin-top:0px; margin-right:16px; margin-bottom:0px; margin-left:12px; line-height:1.00; background-color:transparent; white-space:normal; page-break-inside:auto; page-break-after:auto; border:none; tabstops:144px left ;"></para>
  </body>
</topic>
